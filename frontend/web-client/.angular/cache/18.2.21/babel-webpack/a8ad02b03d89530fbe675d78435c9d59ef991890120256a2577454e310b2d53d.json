{"ast":null,"code":"import { inject } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { forkJoin } from 'rxjs';\nimport { map, shareReplay } from 'rxjs/operators';\nimport { environment } from '../../environments/environment.development';\nimport * as i0 from \"@angular/core\";\nexport let ListingsApiService = /*#__PURE__*/(() => {\n  class ListingsApiService {\n    http = inject(HttpClient);\n    baseUrl = environment.apiBaseUrl;\n    catalogBaseUrl = environment.catalogApiBaseUrl;\n    // Cached streams for reference data (no params)\n    makesCache$;\n    featuresCache$;\n    optionsCache$;\n    // Reference data direct from CatalogService\n    getMakes() {\n      if (!this.makesCache$) {\n        this.makesCache$ = this.http.get(`${this.catalogBaseUrl}/makes`).pipe(shareReplay(1));\n      }\n      return this.makesCache$;\n    }\n    getModels(makeId) {\n      const params = {};\n      if (makeId) params.makeId = makeId;\n      return this.http.get(`${this.catalogBaseUrl}/models`, {\n        params\n      });\n    }\n    getGenerations(modelId) {\n      const params = {};\n      if (modelId) params.modelId = modelId;\n      return this.http.get(`${this.catalogBaseUrl}/generations`, {\n        params\n      });\n    }\n    getDerivatives(modelId) {\n      const params = {};\n      if (modelId) params.modelId = modelId;\n      return this.http.get(`${this.catalogBaseUrl}/derivatives`, {\n        params\n      });\n    }\n    // Variants are filtered by generation in CatalogService\n    getVariantsByGeneration(generationId) {\n      const params = {\n        generationId\n      };\n      return this.http.get(`${this.catalogBaseUrl}/variants`, {\n        params\n      });\n    }\n    // Combine options from two endpoints\n    getOptions() {\n      if (!this.optionsCache$) {\n        this.optionsCache$ = forkJoin({\n          varOpts: this.http.get(`${this.catalogBaseUrl}/variants/options`),\n          bodies: this.http.get(`${this.catalogBaseUrl}/derivatives/options`)\n        }).pipe(map(({\n          varOpts,\n          bodies\n        }) => ({\n          transmissions: varOpts.transmissions,\n          fuelTypes: varOpts.fuelTypes,\n          bodyTypes: bodies\n        })), shareReplay(1));\n      }\n      return this.optionsCache$;\n    }\n    getVariantFeatures(variantId) {\n      return this.http.get(`${this.catalogBaseUrl}/variantfeatures`, {\n        params: {\n          variantId\n        }\n      });\n    }\n    getFeatures() {\n      if (!this.featuresCache$) {\n        this.featuresCache$ = this.http.get(`${this.catalogBaseUrl}/features`).pipe(shareReplay(1));\n      }\n      return this.featuresCache$;\n    }\n    // ListingService endpoints\n    getListings(params) {\n      const clean = params ? this.cleanParams(params) : undefined;\n      const options = clean ? {\n        params: clean\n      } : {};\n      return this.http.get(`${this.baseUrl}/listings`, options);\n    }\n    searchListings(params) {\n      const clean = this.cleanParams(params);\n      return this.http.get(`${this.baseUrl}/listings/search`, {\n        params: clean\n      });\n    }\n    cleanParams(params) {\n      const q = {};\n      for (const [k, v] of Object.entries(params)) {\n        if (v === undefined || v === null) continue;\n        if (Array.isArray(v)) {\n          if (v.length === 0) continue; // omit empty arrays to avoid accidental over-filtering\n          q[k] = v.map(x => String(x)); // ensure proper serialization as string[]\n          continue;\n        }\n        q[k] = v;\n      }\n      return q;\n    }\n    createListing(dto) {\n      return this.http.post(`${this.baseUrl}/listings`, dto);\n    }\n    getListing(id) {\n      return this.http.get(`${this.baseUrl}/listings/${id}`);\n    }\n    updateListing(id, dto) {\n      return this.http.put(`${this.baseUrl}/listings/${id}`, dto);\n    }\n    uploadListingImages(listingId, files) {\n      const fd = new FormData();\n      for (const f of files) fd.append('files', f);\n      return this.http.post(`${this.baseUrl}/listings/${listingId}/images`, fd);\n    }\n    getListingImages(listingId) {\n      return this.http.get(`${this.baseUrl}/listings/${listingId}/images`);\n    }\n    deleteListingImage(listingId, imageId) {\n      return this.http.delete(`${this.baseUrl}/listings/${listingId}/images/${imageId}`);\n    }\n    static ɵfac = function ListingsApiService_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || ListingsApiService)();\n    };\n    static ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: ListingsApiService,\n      factory: ListingsApiService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n  return ListingsApiService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}