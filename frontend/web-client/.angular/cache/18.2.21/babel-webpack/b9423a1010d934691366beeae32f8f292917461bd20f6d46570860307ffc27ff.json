{"ast":null,"code":"import { inject } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { ReactiveFormsModule, FormBuilder, Validators } from '@angular/forms';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { ObserversModule } from '@angular/cdk/observers';\nimport { MatProgressSpinnerModule } from '@angular/material/progress-spinner';\nimport { ListingsApiService } from './listings-api.service';\nimport { BehaviorSubject, combineLatest, forkJoin } from 'rxjs';\nimport { map, shareReplay, distinctUntilChanged, startWith, finalize } from 'rxjs/operators';\nimport { takeUntilDestroyed } from '@angular/core/rxjs-interop';\nimport { NotificationService } from '../core/notification.service';\nimport { DestroyRef } from '@angular/core';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common\";\nimport * as i2 from \"@angular/forms\";\nimport * as i3 from \"@angular/material/form-field\";\nimport * as i4 from \"@angular/material/input\";\nimport * as i5 from \"@angular/material/select\";\nimport * as i6 from \"@angular/material/core\";\nimport * as i7 from \"@angular/material/button\";\nimport * as i8 from \"@angular/material/card\";\nimport * as i9 from \"@angular/material/progress-spinner\";\nimport * as i10 from \"@angular/material/checkbox\";\nimport * as i11 from \"@angular/material/icon\";\nimport * as i12 from \"@angular/material/tooltip\";\nimport * as i13 from \"@angular/material/divider\";\nfunction AddListingComponent_mat_option_15_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-option\", 42);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const y_r2 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", y_r2);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(y_r2);\n  }\n}\nfunction AddListingComponent_mat_error_19_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵtext(1, \"Please choose the registration year\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AddListingComponent_mat_option_24_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-option\", 42);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const m_r3 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", m_r3.id);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(m_r3.name);\n  }\n}\nfunction AddListingComponent_mat_error_26_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵtext(1, \"Select the car make\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AddListingComponent_mat_option_31_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-option\", 42);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const m_r4 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", m_r4.id);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(m_r4.name);\n  }\n}\nfunction AddListingComponent_mat_error_33_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵtext(1, \"Select the model\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AddListingComponent_mat_option_38_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-option\", 42);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const v_r5 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", v_r5.id);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(v_r5.name);\n  }\n}\nfunction AddListingComponent_mat_error_40_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵtext(1, \"Choose the specific variant\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AddListingComponent_mat_error_48_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵtext(1, \"Please enter the mileage\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AddListingComponent_mat_error_49_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵtext(1, \"Mileage cannot be negative\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AddListingComponent_mat_error_57_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵtext(1, \"Please enter the car price\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AddListingComponent_mat_error_58_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵtext(1, \"Price must be zero or higher\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AddListingComponent_mat_option_69_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-option\", 42);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const t_r6 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", t_r6.id);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(t_r6.name);\n  }\n}\nfunction AddListingComponent_mat_option_75_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-option\", 42);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const f_r7 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", f_r7.id);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(f_r7.name);\n  }\n}\nfunction AddListingComponent_mat_option_81_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-option\", 42);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const b_r8 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", b_r8.id);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(b_r8.name);\n  }\n}\nfunction AddListingComponent_mat_error_83_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵtext(1, \"Please choose a body type\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AddListingComponent_ng_container_88_ng_container_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r9 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"mat-checkbox\", 43);\n    i0.ɵɵlistener(\"change\", function AddListingComponent_ng_container_88_ng_container_1_Template_mat_checkbox_change_1_listener($event) {\n      i0.ɵɵrestoreView(_r9);\n      const f_r10 = i0.ɵɵnextContext().$implicit;\n      const ctx_r10 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r10.toggleFeature(f_r10.id, $event.checked));\n    });\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const f_r10 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"checked\", true);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(f_r10.name);\n  }\n}\nfunction AddListingComponent_ng_container_88_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtemplate(1, AddListingComponent_ng_container_88_ng_container_1_Template, 3, 2, \"ng-container\", 9);\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const f_r10 = ctx.$implicit;\n    const ctx_r10 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r10.selectedFeatureIds.has(f_r10.id));\n  }\n}\nfunction AddListingComponent_ng_container_89_ng_container_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r12 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"mat-checkbox\", 43);\n    i0.ɵɵlistener(\"change\", function AddListingComponent_ng_container_89_ng_container_1_Template_mat_checkbox_change_1_listener($event) {\n      i0.ɵɵrestoreView(_r12);\n      const f_r13 = i0.ɵɵnextContext().$implicit;\n      const ctx_r10 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r10.toggleFeature(f_r13.id, $event.checked));\n    });\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const f_r13 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"checked\", false);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(f_r13.name);\n  }\n}\nfunction AddListingComponent_ng_container_89_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtemplate(1, AddListingComponent_ng_container_89_ng_container_1_Template, 3, 2, \"ng-container\", 9);\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const f_r13 = ctx.$implicit;\n    const ctx_r10 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", !ctx_r10.selectedFeatureIds.has(f_r13.id));\n  }\n}\nfunction AddListingComponent_div_115_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 47);\n    i0.ɵɵtext(1, \"Cover\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AddListingComponent_div_115_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 44);\n    i0.ɵɵelement(1, \"img\", 45);\n    i0.ɵɵtemplate(2, AddListingComponent_div_115_div_2_Template, 2, 0, \"div\", 46);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const p_r15 = ctx.$implicit;\n    const i_r16 = ctx.index;\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"src\", p_r15, i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", i_r16 === 0);\n  }\n}\nfunction AddListingComponent_mat_progress_spinner_145_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"mat-progress-spinner\", 48);\n  }\n}\nfunction AddListingComponent_span_146_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1, \"Add Listing\");\n    i0.ɵɵelementEnd();\n  }\n}\nexport let AddListingComponent = /*#__PURE__*/(() => {\n  class AddListingComponent {\n    fb = inject(FormBuilder);\n    api = inject(ListingsApiService);\n    notify = inject(NotificationService);\n    destroyRef = inject(DestroyRef);\n    saving = false;\n    years = [];\n    form = this.fb.group({\n      description: [''],\n      year: [null, [Validators.required, Validators.min(1900)]],\n      mileage: [0, [Validators.required, Validators.min(0)]],\n      price: [0, [Validators.required, Validators.min(0)]],\n      makeId: [null, Validators.required],\n      modelId: [null, Validators.required],\n      // Hidden fields, set programmatically based on selected variant\n      generationId: [null],\n      derivativeId: [null],\n      // Variant is now optional per requirements\n      variantId: [null],\n      transmissionId: [null],\n      fuelTypeId: [null],\n      bodyTypeId: [null, Validators.required]\n    });\n    // State subjects (mirroring web-admin style)\n    makes$ = new BehaviorSubject([]);\n    models$ = new BehaviorSubject([]);\n    generations$ = new BehaviorSubject([]);\n    derivatives$ = new BehaviorSubject([]);\n    variants$ = new BehaviorSubject([]);\n    transmissions$ = new BehaviorSubject([]);\n    fuelTypes$ = new BehaviorSubject([]);\n    bodyTypes$ = new BehaviorSubject([]);\n    features$ = new BehaviorSubject([]);\n    variantFeatures$ = new BehaviorSubject([]);\n    // Backing arrays for existing template usage\n    makes = [];\n    models = [];\n    generations = [];\n    derivatives = [];\n    variants = [];\n    transmissions = [];\n    fuelTypes = [];\n    bodyTypes = [];\n    variantFeatures = [];\n    features = [];\n    selectedFeatureIds = new Set();\n    selectedFiles = [];\n    previews = [];\n    dragging = false;\n    skipVariant = false;\n    constructor() {\n      // Build years dropdown (descending from current year to 1900)\n      const current = new Date().getFullYear();\n      for (let y = current; y >= 1900; y--) this.years.push(y);\n      // Load static reference data\n      // Load static reference data\n      this.api.getMakes().pipe(takeUntilDestroyed(this.destroyRef)).subscribe(m => {\n        this.makes = m;\n        this.makes$.next(m);\n      });\n      this.api.getOptions().pipe(takeUntilDestroyed(this.destroyRef)).subscribe(o => {\n        this.transmissions = o.transmissions;\n        this.fuelTypes = o.fuelTypes;\n        this.bodyTypes = o.bodyTypes;\n        this.transmissions$.next(o.transmissions);\n        this.fuelTypes$.next(o.fuelTypes);\n        this.bodyTypes$.next(o.bodyTypes);\n      });\n      this.api.getFeatures().pipe(takeUntilDestroyed(this.destroyRef)).subscribe(f => {\n        this.features = f;\n        this.features$.next(f);\n      });\n      // When Make changes: load models under make, aggregate derivatives/generations for its models, then refresh variants\n      this.form.get('makeId').valueChanges.pipe(distinctUntilChanged(), takeUntilDestroyed(this.destroyRef)).subscribe(makeId => {\n        this.models = [];\n        this.generations = [];\n        this.derivatives = [];\n        this.variants = [];\n        this.variantFeatures = [];\n        this.form.patchValue({\n          modelId: null,\n          generationId: null,\n          derivativeId: null,\n          variantId: null\n        }, {\n          emitEvent: false\n        });\n        if (!makeId) {\n          this.models$.next([]);\n          this.generations$.next([]);\n          this.derivatives$.next([]);\n          this.refreshVariants();\n          return;\n        }\n        this.api.getModels(makeId).pipe(takeUntilDestroyed(this.destroyRef)).subscribe(models => {\n          this.models = models;\n          this.models$.next(models);\n          if (models.length === 0) {\n            this.refreshVariants();\n            return;\n          }\n          const genReqs = models.map(m => this.api.getGenerations(m.id));\n          const derReqs = models.map(m => this.api.getDerivatives(m.id));\n          forkJoin({\n            gens: forkJoin(genReqs).pipe(map(groups => groups.flat())),\n            ders: forkJoin(derReqs).pipe(map(groups => groups.flat()))\n          }).pipe(takeUntilDestroyed(this.destroyRef)).subscribe(({\n            gens,\n            ders\n          }) => {\n            this.generations = gens;\n            this.derivatives = ders;\n            this.generations$.next(gens);\n            this.derivatives$.next(ders);\n            this.refreshVariants();\n          });\n        });\n      });\n      // When Model changes: refresh variants (derivatives/generations already loaded for make)\n      this.form.get('modelId').valueChanges.pipe(distinctUntilChanged(), takeUntilDestroyed(this.destroyRef)).subscribe(() => {\n        this.variants = [];\n        this.form.patchValue({\n          variantId: null\n        }, {\n          emitEvent: false\n        });\n        this.refreshVariants();\n      });\n      // When Year changes: recompute variants\n      this.form.get('year').valueChanges.pipe(distinctUntilChanged(), takeUntilDestroyed(this.destroyRef)).subscribe(() => {\n        this.variants = [];\n        this.form.patchValue({\n          variantId: null\n        }, {\n          emitEvent: false\n        });\n        this.refreshVariants();\n      });\n      // On Variant selection: derive generation/derivative and load features\n      this.form.get('variantId').valueChanges.pipe(distinctUntilChanged(), takeUntilDestroyed(this.destroyRef)).subscribe(variantId => {\n        this.variantFeatures = [];\n        this.variantFeatures$.next([]);\n        this.selectedFeatureIds.clear();\n        const variant = this.variants.find(v => v.id === variantId);\n        const der = this.derivatives.find(d => d.id === variant?.derivativeId);\n        const genId = der?.generationId ?? null;\n        this.form.patchValue({\n          derivativeId: der?.id ?? null,\n          generationId: genId\n        }, {\n          emitEvent: false\n        });\n        if (variantId) this.api.getVariantFeatures(variantId).pipe(takeUntilDestroyed(this.destroyRef)).subscribe(vf => {\n          this.variantFeatures = vf;\n          this.variantFeatures$.next(vf);\n          // Preselect variant features\n          vf.forEach(v => this.selectedFeatureIds.add(v.featureId));\n        });\n        // Populate additional information from derivative when available\n        const byName = (arr, name) => {\n          if (!name) return null;\n          const target = (name || '').toLowerCase();\n          return arr.find(a => (a.name || '').toLowerCase() === target)?.id ?? null;\n        };\n        if (der) {\n          const trId = byName(this.transmissions, der.transmission);\n          const fuId = byName(this.fuelTypes, der.fuelType);\n          const btId = byName(this.bodyTypes, der.bodyType);\n          this.form.patchValue({\n            transmissionId: trId,\n            fuelTypeId: fuId,\n            bodyTypeId: btId\n          }, {\n            emitEvent: false\n          });\n        }\n      });\n      // Derived variants stream (cached)\n      combineLatest([this.generations$.pipe(startWith([])), this.derivatives$.pipe(startWith([])), this.models$.pipe(startWith([])), this.form.get('modelId').valueChanges.pipe(startWith(this.form.value.modelId)), this.form.get('year').valueChanges.pipe(startWith(this.form.value.year)), this.form.get('makeId').valueChanges.pipe(startWith(this.form.value.makeId))]).pipe(map(([generations, derivatives, models, modelId, year, makeId]) => {\n        if (!makeId || !year) return [];\n        const allowedModelIds = new Set(models.map(m => m.id));\n        const gensForYear = generations.filter(g => {\n          const start = g.startYear ?? 0;\n          const end = g.endYear ?? 9999;\n          const inYear = year >= start && year <= end;\n          const inMake = allowedModelIds.has(g.modelId);\n          const matchesModel = !modelId || g.modelId === modelId;\n          return inYear && inMake && matchesModel;\n        });\n        if (gensForYear.length === 0) return [];\n        // Keep imperative fetch for variants by generation; result applied in refreshVariants\n        return [];\n      }), shareReplay(1), takeUntilDestroyed(this.destroyRef)).subscribe();\n    }\n    findById(list, id) {\n      if (id == null) return undefined;\n      return list.find(x => x.id === id);\n    }\n    submit() {\n      if (this.form.invalid || this.saving) return;\n      this.saving = true;\n      this.form.disable({\n        emitEvent: false\n      });\n      const raw = this.form.value;\n      const makeName = this.makes.find(x => x.id === raw.makeId)?.name;\n      const modelName = this.models.find(x => x.id === raw.modelId)?.name;\n      const year = raw.year;\n      const computedTitle = `${makeName ?? ''} ${modelName ?? ''} ${year}`.trim();\n      const derivative = this.derivatives.find(x => x.id === raw.derivativeId);\n      const featureInputs = Array.from(this.selectedFeatureIds).map(id => {\n        const f = this.features.find(x => x.id === id);\n        return {\n          featureCode: f?.code ?? String(id),\n          featureName: f?.name ?? '',\n          featureDescription: f?.description,\n          featureCategoryName: f?.featureCategory ?? '',\n          featureCategoryCode: f?.featureCategoryCode ?? ''\n        };\n      });\n      const dto = {\n        title: computedTitle,\n        description: raw.description ?? undefined,\n        year: raw.year,\n        mileage: raw.mileage,\n        price: raw.price,\n        makeCode: this.makes.find(x => x.id === raw.makeId)?.code,\n        modelCode: this.models.find(x => x.id === raw.modelId)?.code,\n        generationCode: this.generations.find(x => x.id === raw.generationId)?.code,\n        derivativeCode: this.derivatives.find(x => x.id === raw.derivativeId)?.code,\n        variantCode: this.variants.find(x => x.id === raw.variantId)?.code,\n        transmissionTypeCode: raw.transmissionId ? this.transmissions.find(x => x.id === raw.transmissionId)?.code : undefined,\n        fuelTypeCode: raw.fuelTypeId ? this.fuelTypes.find(x => x.id === raw.fuelTypeId)?.code : undefined,\n        bodyTypeCode: this.bodyTypes.find(x => x.id === raw.bodyTypeId)?.code,\n        // Optional labels (snapshots)\n        makeName,\n        modelName,\n        generationName: this.generations.find(x => x.id === raw.generationId)?.name,\n        derivativeName: this.derivatives.find(x => x.id === raw.derivativeId)?.name,\n        variantName: this.variants.find(x => x.id === raw.variantId)?.name,\n        bodyTypeName: this.bodyTypes.find(x => x.id === raw.bodyTypeId)?.name ?? this.derivatives.find(x => x.id === raw.derivativeId)?.bodyType,\n        transmissionTypeName: (raw.transmissionId ? this.transmissions.find(x => x.id === raw.transmissionId)?.name : undefined) ?? this.derivatives.find(x => x.id === raw.derivativeId)?.transmission,\n        fuelTypeName: (raw.fuelTypeId ? this.fuelTypes.find(x => x.id === raw.fuelTypeId)?.name : undefined) ?? this.derivatives.find(x => x.id === raw.derivativeId)?.fuelType,\n        seats: derivative?.seats,\n        doors: derivative?.doors,\n        features: featureInputs\n      };\n      this.api.createListing(dto).subscribe({\n        next: created => {\n          const upload$ = this.selectedFiles.length ? this.api.uploadListingImages(created.id, this.selectedFiles) : undefined;\n          if (upload$) {\n            upload$.pipe(finalize(() => {\n              this.saving = false;\n              this.form.enable({\n                emitEvent: false\n              });\n            })).subscribe({\n              next: () => this.afterCreated(),\n              error: e => {\n                this.saving = false;\n                this.form.enable({\n                  emitEvent: false\n                });\n                this.notify.error(typeof e === 'string' ? e : 'Failed to upload images');\n              }\n            });\n          } else {\n            this.saving = false;\n            this.form.enable({\n              emitEvent: false\n            });\n            this.afterCreated();\n          }\n        },\n        error: e => {\n          this.saving = false;\n          this.form.enable({\n            emitEvent: false\n          });\n          this.notify.error(typeof e === 'string' ? e : 'Failed to create listing');\n        }\n      });\n    }\n    // Additional Information: toggle feature selection\n    toggleFeature(featureId, checked) {\n      if (checked) this.selectedFeatureIds.add(featureId);else this.selectedFeatureIds.delete(featureId);\n    }\n    refreshVariants() {\n      const makeId = this.form.value.makeId;\n      const modelId = this.form.value.modelId;\n      const year = this.form.value.year;\n      if (!makeId || !year) return; // Need at least make + year\n      const allowedModelIds = new Set(this.models.map(m => m.id));\n      // Filter generations by year range and by model filter (if a model is chosen)\n      const gensForYear = this.generations.filter(g => {\n        const start = g.startYear ?? 0;\n        const end = g.endYear ?? 9999;\n        const inYear = year >= start && year <= end;\n        const inMake = allowedModelIds.has(g.modelId);\n        const matchesModel = !modelId || g.modelId === modelId;\n        return inYear && inMake && matchesModel;\n      });\n      if (gensForYear.length === 0) {\n        this.variants = [];\n        return;\n      }\n      forkJoin(gensForYear.map(g => this.api.getVariantsByGeneration(g.id))).pipe(map(groups => groups.flat())).subscribe(vars => {\n        const allowedDerivatives = this.derivatives.filter(d => allowedModelIds.has(d.modelId) && (!modelId || d.modelId === modelId));\n        const allowedDerIds = new Set(allowedDerivatives.map(d => d.id));\n        const filtered = vars.filter(v => allowedDerIds.has(v.derivativeId));\n        this.variants = filtered;\n        this.variants$.next(filtered);\n      });\n    }\n    onFilesSelected(ev) {\n      const input = ev.target;\n      const files = input.files;\n      const list = files ? Array.from(files) : [];\n      // Validate: max 10 files, type and size (<=5MB)\n      const maxCount = 10;\n      const maxSize = 5 * 1024 * 1024;\n      const allowed = new Set(['image/jpeg', 'image/png', 'image/webp', 'image/gif']);\n      const filtered = [];\n      for (const f of list) {\n        if (filtered.length >= maxCount) break;\n        if (!allowed.has(f.type)) continue;\n        if (f.size > maxSize) continue;\n        filtered.push(f);\n      }\n      this.selectedFiles = filtered;\n      // Build previews\n      this.previews.forEach(url => URL.revokeObjectURL(url));\n      this.previews = this.selectedFiles.map(f => URL.createObjectURL(f));\n    }\n    afterCreated() {\n      const ref = this.notify.success('Listing created', 'View listings');\n      ref.onAction().subscribe(() => {\n        const el = document.getElementById('listings-section');\n        if (el) el.scrollIntoView({\n          behavior: 'smooth',\n          block: 'start'\n        });\n      });\n      // Reset selected files and previews\n      this.selectedFiles = [];\n      this.previews.forEach(url => URL.revokeObjectURL(url));\n      this.previews = [];\n    }\n    // Drag & drop helpers (UI only)\n    onDragOver(event) {\n      event.preventDefault();\n      this.dragging = true;\n    }\n    onDragLeave(event) {\n      event.preventDefault();\n      this.dragging = false;\n    }\n    onDrop(event) {\n      event.preventDefault();\n      this.dragging = false;\n      const files = event.dataTransfer?.files;\n      if (!files || files.length === 0) return;\n      const inputEvent = {\n        target: {\n          files\n        }\n      };\n      this.onFilesSelected(inputEvent);\n    }\n    static ɵfac = function AddListingComponent_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || AddListingComponent)();\n    };\n    static ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: AddListingComponent,\n      selectors: [[\"app-add-listing\"]],\n      standalone: true,\n      features: [i0.ɵɵStandaloneFeature],\n      decls: 147,\n      vars: 39,\n      consts: [[\"fileInput\", \"\"], [1, \"sell-form\", 3, \"ngSubmit\", \"formGroup\"], [1, \"section-card\"], [\"mat-card-avatar\", \"\", \"color\", \"primary\"], [1, \"grid\", \"grid--car\"], [\"appearance\", \"outline\"], [\"formControlName\", \"year\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [\"mat-icon-button\", \"\", \"matSuffix\", \"\", \"matTooltip\", \"Year first registered\", \"aria-label\", \"Help about year\"], [4, \"ngIf\"], [\"formControlName\", \"makeId\"], [\"formControlName\", \"modelId\"], [\"formControlName\", \"variantId\"], [\"matInput\", \"\", \"type\", \"number\", \"formControlName\", \"mileage\", \"aria-label\", \"Mileage\"], [\"mat-icon-button\", \"\", \"matSuffix\", \"\", \"matTooltip\", \"Enter the current odometer reading\"], [\"matInput\", \"\", \"type\", \"number\", \"formControlName\", \"price\", \"aria-label\", \"Price\"], [\"mat-icon-button\", \"\", \"matSuffix\", \"\", \"matTooltip\", \"Set a competitive price\"], [\"appearance\", \"outline\", 1, \"grid-col-span-2\"], [\"matInput\", \"\", \"rows\", \"3\", \"formControlName\", \"description\", \"aria-label\", \"Description\", \"matTooltip\", \"Add highlights like condition, service history, extras\"], [1, \"subheading\"], [\"formControlName\", \"transmissionId\"], [\"formControlName\", \"fuelTypeId\"], [\"formControlName\", \"bodyTypeId\"], [1, \"features\"], [1, \"features__title\"], [1, \"features__grid\"], [4, \"ngFor\", \"ngForOf\"], [1, \"upload\"], [\"tabindex\", \"0\", \"role\", \"button\", \"aria-label\", \"Upload images\", 1, \"upload__drop\", 3, \"click\", \"keydown.enter\", \"dragover\", \"dragleave\", \"drop\"], [1, \"u-link\"], [\"matTooltip\", \"JPG, PNG, WEBP up to 5MB. Aim for 6\\u201310 photos.\", 1, \"upload__hint\"], [\"type\", \"file\", \"multiple\", \"\", \"accept\", \"image/*\", 1, \"visually-hidden\", 3, \"change\"], [1, \"upload__meta\"], [1, \"upload__grid\"], [\"class\", \"upload__item\", 4, \"ngFor\", \"ngForOf\"], [1, \"grid\", \"grid--contact\"], [\"matInput\", \"\", \"aria-label\", \"Name\", \"placeholder\", \"Your full name\"], [\"matInput\", \"\", \"type\", \"tel\", \"aria-label\", \"Phone\", \"placeholder\", \"e.g. 07123 456789\"], [\"matInput\", \"\", \"type\", \"email\", \"aria-label\", \"Email\", \"placeholder\", \"you@example.com\"], [1, \"actions\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", \"type\", \"submit\", 3, \"disabled\"], [\"mode\", \"indeterminate\", \"diameter\", \"18\", \"strokeWidth\", \"3\", 4, \"ngIf\"], [3, \"value\"], [\"color\", \"primary\", 3, \"change\", \"checked\"], [1, \"upload__item\"], [\"alt\", \"preview image\", 3, \"src\"], [\"class\", \"upload__badge\", 4, \"ngIf\"], [1, \"upload__badge\"], [\"mode\", \"indeterminate\", \"diameter\", \"18\", \"strokeWidth\", \"3\"]],\n      template: function AddListingComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          const _r1 = i0.ɵɵgetCurrentView();\n          i0.ɵɵelementStart(0, \"form\", 1);\n          i0.ɵɵlistener(\"ngSubmit\", function AddListingComponent_Template_form_ngSubmit_0_listener() {\n            i0.ɵɵrestoreView(_r1);\n            return i0.ɵɵresetView(ctx.submit());\n          });\n          i0.ɵɵelementStart(1, \"mat-card\", 2)(2, \"mat-card-header\")(3, \"mat-icon\", 3);\n          i0.ɵɵtext(4, \"directions_car\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(5, \"mat-card-title\");\n          i0.ɵɵtext(6, \"Car Information\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(7, \"mat-card-subtitle\");\n          i0.ɵɵtext(8, \"Tell buyers the key details\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(9, \"mat-card-content\")(10, \"div\", 4)(11, \"mat-form-field\", 5)(12, \"mat-label\");\n          i0.ɵɵtext(13, \"Year\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(14, \"mat-select\", 6);\n          i0.ɵɵtemplate(15, AddListingComponent_mat_option_15_Template, 2, 2, \"mat-option\", 7);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(16, \"button\", 8)(17, \"mat-icon\");\n          i0.ɵɵtext(18, \"calendar_today\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵtemplate(19, AddListingComponent_mat_error_19_Template, 2, 0, \"mat-error\", 9);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(20, \"mat-form-field\", 5)(21, \"mat-label\");\n          i0.ɵɵtext(22, \"Make\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(23, \"mat-select\", 10);\n          i0.ɵɵtemplate(24, AddListingComponent_mat_option_24_Template, 2, 2, \"mat-option\", 7);\n          i0.ɵɵpipe(25, \"async\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(26, AddListingComponent_mat_error_26_Template, 2, 0, \"mat-error\", 9);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(27, \"mat-form-field\", 5)(28, \"mat-label\");\n          i0.ɵɵtext(29, \"Model\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(30, \"mat-select\", 11);\n          i0.ɵɵtemplate(31, AddListingComponent_mat_option_31_Template, 2, 2, \"mat-option\", 7);\n          i0.ɵɵpipe(32, \"async\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(33, AddListingComponent_mat_error_33_Template, 2, 0, \"mat-error\", 9);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(34, \"mat-form-field\", 5)(35, \"mat-label\");\n          i0.ɵɵtext(36, \"Variant\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(37, \"mat-select\", 12);\n          i0.ɵɵtemplate(38, AddListingComponent_mat_option_38_Template, 2, 2, \"mat-option\", 7);\n          i0.ɵɵpipe(39, \"async\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(40, AddListingComponent_mat_error_40_Template, 2, 0, \"mat-error\", 9);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(41, \"mat-form-field\", 5)(42, \"mat-label\");\n          i0.ɵɵtext(43, \"Mileage\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(44, \"input\", 13);\n          i0.ɵɵelementStart(45, \"button\", 14)(46, \"mat-icon\");\n          i0.ɵɵtext(47, \"speed\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵtemplate(48, AddListingComponent_mat_error_48_Template, 2, 0, \"mat-error\", 9)(49, AddListingComponent_mat_error_49_Template, 2, 0, \"mat-error\", 9);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(50, \"mat-form-field\", 5)(51, \"mat-label\");\n          i0.ɵɵtext(52, \"Price\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(53, \"input\", 15);\n          i0.ɵɵelementStart(54, \"button\", 16)(55, \"mat-icon\");\n          i0.ɵɵtext(56, \"attach_money\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵtemplate(57, AddListingComponent_mat_error_57_Template, 2, 0, \"mat-error\", 9)(58, AddListingComponent_mat_error_58_Template, 2, 0, \"mat-error\", 9);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(59, \"mat-form-field\", 17)(60, \"mat-label\");\n          i0.ɵɵtext(61, \"Description\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(62, \"textarea\", 18);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(63, \"h4\", 19);\n          i0.ɵɵtext(64, \"Additional Information!\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(65, \"mat-form-field\", 5)(66, \"mat-label\");\n          i0.ɵɵtext(67, \"Transmission\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(68, \"mat-select\", 20);\n          i0.ɵɵtemplate(69, AddListingComponent_mat_option_69_Template, 2, 2, \"mat-option\", 7);\n          i0.ɵɵpipe(70, \"async\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(71, \"mat-form-field\", 5)(72, \"mat-label\");\n          i0.ɵɵtext(73, \"Fuel Type\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(74, \"mat-select\", 21);\n          i0.ɵɵtemplate(75, AddListingComponent_mat_option_75_Template, 2, 2, \"mat-option\", 7);\n          i0.ɵɵpipe(76, \"async\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(77, \"mat-form-field\", 5)(78, \"mat-label\");\n          i0.ɵɵtext(79, \"Body Type\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(80, \"mat-select\", 22);\n          i0.ɵɵtemplate(81, AddListingComponent_mat_option_81_Template, 2, 2, \"mat-option\", 7);\n          i0.ɵɵpipe(82, \"async\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(83, AddListingComponent_mat_error_83_Template, 2, 0, \"mat-error\", 9);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(84, \"div\", 23)(85, \"div\", 24);\n          i0.ɵɵtext(86, \"Features\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(87, \"div\", 25);\n          i0.ɵɵtemplate(88, AddListingComponent_ng_container_88_Template, 2, 1, \"ng-container\", 26)(89, AddListingComponent_ng_container_89_Template, 2, 1, \"ng-container\", 26);\n          i0.ɵɵelementEnd()()()();\n          i0.ɵɵelement(90, \"mat-divider\");\n          i0.ɵɵelementStart(91, \"mat-card\", 2)(92, \"mat-card-header\")(93, \"mat-icon\", 3);\n          i0.ɵɵtext(94, \"photo_library\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(95, \"mat-card-title\");\n          i0.ɵɵtext(96, \"Upload Media\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(97, \"mat-card-subtitle\");\n          i0.ɵɵtext(98, \"High\\u2011quality photos sell faster\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(99, \"mat-card-content\")(100, \"div\", 27)(101, \"div\", 28);\n          i0.ɵɵlistener(\"click\", function AddListingComponent_Template_div_click_101_listener() {\n            i0.ɵɵrestoreView(_r1);\n            const fileInput_r14 = i0.ɵɵreference(111);\n            return i0.ɵɵresetView(fileInput_r14.click());\n          })(\"keydown.enter\", function AddListingComponent_Template_div_keydown_enter_101_listener() {\n            i0.ɵɵrestoreView(_r1);\n            const fileInput_r14 = i0.ɵɵreference(111);\n            return i0.ɵɵresetView(fileInput_r14.click());\n          })(\"dragover\", function AddListingComponent_Template_div_dragover_101_listener($event) {\n            i0.ɵɵrestoreView(_r1);\n            return i0.ɵɵresetView(ctx.onDragOver($event));\n          })(\"dragleave\", function AddListingComponent_Template_div_dragleave_101_listener($event) {\n            i0.ɵɵrestoreView(_r1);\n            return i0.ɵɵresetView(ctx.onDragLeave($event));\n          })(\"drop\", function AddListingComponent_Template_div_drop_101_listener($event) {\n            i0.ɵɵrestoreView(_r1);\n            return i0.ɵɵresetView(ctx.onDrop($event));\n          });\n          i0.ɵɵelementStart(102, \"mat-icon\");\n          i0.ɵɵtext(103, \"cloud_upload\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(104, \"div\");\n          i0.ɵɵtext(105, \"Drag & drop images here or \");\n          i0.ɵɵelementStart(106, \"span\", 29);\n          i0.ɵɵtext(107, \"browse\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(108, \"div\", 30);\n          i0.ɵɵtext(109, \"JPG, PNG, WEBP \\u2022 Max 5MB each\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(110, \"input\", 31, 0);\n          i0.ɵɵlistener(\"change\", function AddListingComponent_Template_input_change_110_listener($event) {\n            i0.ɵɵrestoreView(_r1);\n            return i0.ɵɵresetView(ctx.onFilesSelected($event));\n          });\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(112, \"div\", 32);\n          i0.ɵɵtext(113);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(114, \"div\", 33);\n          i0.ɵɵtemplate(115, AddListingComponent_div_115_Template, 3, 2, \"div\", 34);\n          i0.ɵɵelementEnd()()()();\n          i0.ɵɵelement(116, \"mat-divider\");\n          i0.ɵɵelementStart(117, \"mat-card\", 2)(118, \"mat-card-header\")(119, \"mat-icon\", 3);\n          i0.ɵɵtext(120, \"person\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(121, \"mat-card-title\");\n          i0.ɵɵtext(122, \"Contact Information\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(123, \"mat-card-subtitle\");\n          i0.ɵɵtext(124, \"Your details are only shared with interested buyers\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(125, \"mat-card-content\")(126, \"div\", 35)(127, \"mat-form-field\", 5)(128, \"mat-label\");\n          i0.ɵɵtext(129, \"Name\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(130, \"input\", 36);\n          i0.ɵɵelementStart(131, \"mat-hint\");\n          i0.ɵɵtext(132, \"Shown to buyers when they message you\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(133, \"mat-form-field\", 5)(134, \"mat-label\");\n          i0.ɵɵtext(135, \"Phone\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(136, \"input\", 37);\n          i0.ɵɵelementStart(137, \"mat-hint\");\n          i0.ɵɵtext(138, \"Keep your phone on for quick responses\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(139, \"mat-form-field\", 17)(140, \"mat-label\");\n          i0.ɵɵtext(141, \"Email\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(142, \"input\", 38);\n          i0.ɵɵelementEnd()()()();\n          i0.ɵɵelementStart(143, \"div\", 39)(144, \"button\", 40);\n          i0.ɵɵtemplate(145, AddListingComponent_mat_progress_spinner_145_Template, 1, 0, \"mat-progress-spinner\", 41)(146, AddListingComponent_span_146_Template, 2, 0, \"span\", 9);\n          i0.ɵɵelementEnd()()();\n        }\n        if (rf & 2) {\n          let tmp_4_0;\n          let tmp_5_0;\n          let tmp_6_0;\n          let tmp_7_0;\n          let tmp_8_0;\n          let tmp_9_0;\n          let tmp_10_0;\n          let tmp_11_0;\n          let tmp_12_0;\n          let tmp_13_0;\n          let tmp_14_0;\n          let tmp_15_0;\n          let tmp_16_0;\n          let tmp_17_0;\n          let tmp_18_0;\n          i0.ɵɵproperty(\"formGroup\", ctx.form);\n          i0.ɵɵattribute(\"aria-busy\", ctx.saving);\n          i0.ɵɵadvance(15);\n          i0.ɵɵproperty(\"ngForOf\", ctx.years);\n          i0.ɵɵadvance(4);\n          i0.ɵɵproperty(\"ngIf\", ((tmp_4_0 = ctx.form.get(\"year\")) == null ? null : tmp_4_0.hasError(\"required\")) && ((tmp_4_0 = ctx.form.get(\"year\")) == null ? null : tmp_4_0.touched));\n          i0.ɵɵadvance(5);\n          i0.ɵɵproperty(\"ngForOf\", (tmp_5_0 = i0.ɵɵpipeBind1(25, 27, ctx.makes$)) !== null && tmp_5_0 !== undefined ? tmp_5_0 : ctx.makes);\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"ngIf\", ((tmp_6_0 = ctx.form.get(\"makeId\")) == null ? null : tmp_6_0.hasError(\"required\")) && ((tmp_6_0 = ctx.form.get(\"makeId\")) == null ? null : tmp_6_0.touched));\n          i0.ɵɵadvance(5);\n          i0.ɵɵproperty(\"ngForOf\", (tmp_7_0 = i0.ɵɵpipeBind1(32, 29, ctx.models$)) !== null && tmp_7_0 !== undefined ? tmp_7_0 : ctx.models);\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"ngIf\", ((tmp_8_0 = ctx.form.get(\"modelId\")) == null ? null : tmp_8_0.hasError(\"required\")) && ((tmp_8_0 = ctx.form.get(\"modelId\")) == null ? null : tmp_8_0.touched));\n          i0.ɵɵadvance(5);\n          i0.ɵɵproperty(\"ngForOf\", (tmp_9_0 = i0.ɵɵpipeBind1(39, 31, ctx.variants$)) !== null && tmp_9_0 !== undefined ? tmp_9_0 : ctx.variants);\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"ngIf\", ((tmp_10_0 = ctx.form.get(\"variantId\")) == null ? null : tmp_10_0.hasError(\"required\")) && ((tmp_10_0 = ctx.form.get(\"variantId\")) == null ? null : tmp_10_0.touched));\n          i0.ɵɵadvance(8);\n          i0.ɵɵproperty(\"ngIf\", ((tmp_11_0 = ctx.form.get(\"mileage\")) == null ? null : tmp_11_0.hasError(\"required\")) && ((tmp_11_0 = ctx.form.get(\"mileage\")) == null ? null : tmp_11_0.touched));\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ((tmp_12_0 = ctx.form.get(\"mileage\")) == null ? null : tmp_12_0.hasError(\"min\")) && ((tmp_12_0 = ctx.form.get(\"mileage\")) == null ? null : tmp_12_0.touched));\n          i0.ɵɵadvance(8);\n          i0.ɵɵproperty(\"ngIf\", ((tmp_13_0 = ctx.form.get(\"price\")) == null ? null : tmp_13_0.hasError(\"required\")) && ((tmp_13_0 = ctx.form.get(\"price\")) == null ? null : tmp_13_0.touched));\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ((tmp_14_0 = ctx.form.get(\"price\")) == null ? null : tmp_14_0.hasError(\"min\")) && ((tmp_14_0 = ctx.form.get(\"price\")) == null ? null : tmp_14_0.touched));\n          i0.ɵɵadvance(11);\n          i0.ɵɵproperty(\"ngForOf\", (tmp_15_0 = i0.ɵɵpipeBind1(70, 33, ctx.transmissions$)) !== null && tmp_15_0 !== undefined ? tmp_15_0 : ctx.transmissions);\n          i0.ɵɵadvance(6);\n          i0.ɵɵproperty(\"ngForOf\", (tmp_16_0 = i0.ɵɵpipeBind1(76, 35, ctx.fuelTypes$)) !== null && tmp_16_0 !== undefined ? tmp_16_0 : ctx.fuelTypes);\n          i0.ɵɵadvance(6);\n          i0.ɵɵproperty(\"ngForOf\", (tmp_17_0 = i0.ɵɵpipeBind1(82, 37, ctx.bodyTypes$)) !== null && tmp_17_0 !== undefined ? tmp_17_0 : ctx.bodyTypes);\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"ngIf\", ((tmp_18_0 = ctx.form.get(\"bodyTypeId\")) == null ? null : tmp_18_0.hasError(\"required\")) && ((tmp_18_0 = ctx.form.get(\"bodyTypeId\")) == null ? null : tmp_18_0.touched));\n          i0.ɵɵadvance(5);\n          i0.ɵɵproperty(\"ngForOf\", ctx.features);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngForOf\", ctx.features);\n          i0.ɵɵadvance(12);\n          i0.ɵɵclassProp(\"upload__drop--dragging\", ctx.dragging);\n          i0.ɵɵadvance(12);\n          i0.ɵɵtextInterpolate1(\"Selected: \", ctx.selectedFiles.length, \" file(s)\");\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"ngForOf\", ctx.previews);\n          i0.ɵɵadvance(29);\n          i0.ɵɵproperty(\"disabled\", ctx.saving || ctx.form.invalid);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.saving);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", !ctx.saving);\n        }\n      },\n      dependencies: [CommonModule, i1.NgForOf, i1.NgIf, i1.AsyncPipe, ReactiveFormsModule, i2.ɵNgNoValidate, i2.DefaultValueAccessor, i2.NumberValueAccessor, i2.NgControlStatus, i2.NgControlStatusGroup, i2.FormGroupDirective, i2.FormControlName, ObserversModule, MatFormFieldModule, i3.MatFormField, i3.MatLabel, i3.MatHint, i3.MatError, i3.MatSuffix, MatInputModule, i4.MatInput, MatSelectModule, i5.MatSelect, i6.MatOption, MatOptionModule, MatButtonModule, i7.MatButton, i7.MatIconButton, MatCardModule, i8.MatCard, i8.MatCardAvatar, i8.MatCardContent, i8.MatCardHeader, i8.MatCardSubtitle, i8.MatCardTitle, MatProgressSpinnerModule, i9.MatProgressSpinner, MatCheckboxModule, i10.MatCheckbox, MatIconModule, i11.MatIcon, MatTooltipModule, i12.MatTooltip, MatDividerModule, i13.MatDivider],\n      styles: [\"[_nghost-%COMP%]{display:block}.sell-form[_ngcontent-%COMP%]{display:grid;gap:24px}.section-card[_ngcontent-%COMP%]{padding-bottom:8px;max-width:720px;margin:0 auto}.grid[_ngcontent-%COMP%]{display:grid;gap:16px;justify-items:stretch}.grid--car[_ngcontent-%COMP%], .grid--contact[_ngcontent-%COMP%]{grid-template-columns:1fr}.grid[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{grid-column:1/-1;width:100%}.grid[_ngcontent-%COMP%]   .grid-col-span-2[_ngcontent-%COMP%]{grid-column:1/-1}.features[_ngcontent-%COMP%]{margin-top:8px}.features__title[_ngcontent-%COMP%]{font-weight:600;margin-bottom:6px}.features__grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr;gap:12px;align-items:start;justify-items:start}@media (min-width: 1024px){.features__grid[_ngcontent-%COMP%]{grid-template-columns:1fr 1fr}}.subheading[_ngcontent-%COMP%]{font-weight:700;margin:8px 0}.upload[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.upload__drop[_ngcontent-%COMP%]{border:2px dashed #cbd5e1;border-radius:10px;background:#f8fafc;padding:24px;text-align:center;color:#334155;display:flex;flex-direction:column;gap:8px;align-items:center;justify-content:center;cursor:pointer;outline:none}.upload__drop[_ngcontent-%COMP%]:focus-visible{box-shadow:0 0 0 3px #2563eb59}.upload__drop[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#64748b}.upload__drop--dragging[_ngcontent-%COMP%]{background:#eef2ff;border-color:#94a3b8}.upload__hint[_ngcontent-%COMP%]{font-size:12px;color:#64748b}.u-link[_ngcontent-%COMP%]{color:#2563eb;text-decoration:underline}.visually-hidden[_ngcontent-%COMP%]{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}.upload__meta[_ngcontent-%COMP%]{font-size:12px;color:#475569}.upload__grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:10px}.upload__item[_ngcontent-%COMP%]{position:relative;border:1px solid #e5e7eb;border-radius:8px;overflow:hidden;background:#fff}.upload__item[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;aspect-ratio:4/3;object-fit:cover;display:block}.upload__badge[_ngcontent-%COMP%]{position:absolute;left:8px;top:8px;background:#111827;color:#fff;font-size:11px;padding:2px 6px;border-radius:999px}.actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}.preview-card[_ngcontent-%COMP%]{margin-top:8px}.preview-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:8px}.preview-spanner[_ngcontent-%COMP%]{grid-column:1/-1}\"]\n    });\n  }\n  return AddListingComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}