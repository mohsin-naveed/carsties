{"ast":null,"code":"import { computed, effect, inject, signal } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { ListingsApiService } from '../listings/listings-api.service';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatProgressBarModule } from '@angular/material/progress-bar';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common\";\nimport * as i2 from \"@angular/material/form-field\";\nimport * as i3 from \"@angular/material/select\";\nimport * as i4 from \"@angular/material/core\";\nimport * as i5 from \"@angular/material/card\";\nimport * as i6 from \"@angular/material/progress-bar\";\nfunction SearchComponent_mat_option_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-option\", 4);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const m_r1 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", m_r1.id);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(m_r1.name);\n  }\n}\nfunction SearchComponent_mat_option_17_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-option\", 4);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const m_r2 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", m_r2.id);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(m_r2.name);\n  }\n}\nfunction SearchComponent_mat_option_24_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-option\", 4);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const v_r3 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", v_r3.id);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(v_r3.name);\n  }\n}\nfunction SearchComponent_mat_option_31_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-option\", 4);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const t_r4 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", t_r4.id);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(t_r4.name);\n  }\n}\nfunction SearchComponent_mat_option_38_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-option\", 4);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const b_r5 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", b_r5.id);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(b_r5.name);\n  }\n}\nfunction SearchComponent_mat_option_45_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-option\", 4);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const f_r6 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", f_r6.id);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(f_r6.name);\n  }\n}\nfunction SearchComponent_mat_progress_bar_50_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"mat-progress-bar\", 13);\n  }\n}\nfunction SearchComponent_div_51_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 14);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r6 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\"Showing \", ctx_r6.filteredListings().length, \" results\");\n  }\n}\nfunction SearchComponent_mat_card_53_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-card\", 15)(1, \"mat-card-header\")(2, \"mat-card-title\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"mat-card-subtitle\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(6, \"mat-card-content\")(7, \"div\", 16)(8, \"span\");\n    i0.ɵɵtext(9);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"span\");\n    i0.ɵɵtext(11);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"span\");\n    i0.ɵɵtext(13);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"span\");\n    i0.ɵɵtext(15);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(16, \"div\", 17);\n    i0.ɵɵtext(17);\n    i0.ɵɵpipe(18, \"number\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const car_r8 = ctx.$implicit;\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(car_r8.title);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate3(\" \", car_r8.makeName || car_r8.makeId, \" \\u00B7 \", car_r8.modelName || car_r8.modelId, \" \\u00B7 \", car_r8.year, \" \");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\"Variant: \", car_r8.variantName || car_r8.variantId, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Body: \", car_r8.bodyTypeName || car_r8.bodyTypeId, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Trans: \", car_r8.transmissionName || car_r8.transmissionId || \"-\", \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Fuel: \", car_r8.fuelTypeName || car_r8.fuelTypeId || \"-\", \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"R \", i0.ɵɵpipeBind2(18, 9, car_r8.price, \"1.0-0\"), \"\");\n  }\n}\nfunction SearchComponent_div_54_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 14);\n    i0.ɵɵtext(1, \"No cars match your filters.\");\n    i0.ɵɵelementEnd();\n  }\n}\nexport let SearchComponent = /*#__PURE__*/(() => {\n  class SearchComponent {\n    api = inject(ListingsApiService);\n    // Filters\n    makes = signal([]);\n    models = signal([]);\n    variants = signal([]);\n    transmissions = signal([]);\n    bodyTypes = signal([]);\n    fuelTypes = signal([]);\n    selectedMakeId = signal(null);\n    selectedModelId = signal(null);\n    selectedVariantId = signal(null);\n    selectedTransmissionId = signal(null);\n    selectedBodyTypeId = signal(null);\n    selectedFuelTypeId = signal(null);\n    // Listings\n    allListings = signal([]);\n    loading = signal(true);\n    filteredListings = computed(() => {\n      const makeId = this.selectedMakeId();\n      const modelId = this.selectedModelId();\n      const variantId = this.selectedVariantId();\n      const transmissionId = this.selectedTransmissionId();\n      const bodyTypeId = this.selectedBodyTypeId();\n      const fuelTypeId = this.selectedFuelTypeId();\n      return this.allListings().filter(l => (makeId ? l.makeId === makeId : true) && (modelId ? l.modelId === modelId : true) && (variantId ? l.variantId === variantId : true) && (transmissionId ? l.transmissionId === transmissionId : true) && (bodyTypeId ? l.bodyTypeId === bodyTypeId : true) && (fuelTypeId ? l.fuelTypeId === fuelTypeId : true));\n    });\n    constructor() {\n      // Load initial data\n      this.api.getListings().subscribe({\n        next: xs => {\n          this.allListings.set(xs);\n          this.loading.set(false);\n        },\n        error: _ => {\n          this.loading.set(false);\n        }\n      });\n      this.api.getMakes().subscribe(xs => this.makes.set(xs));\n      this.api.getOptions().subscribe(opts => {\n        this.transmissions.set(opts.transmissions);\n        this.bodyTypes.set(opts.bodyTypes);\n        this.fuelTypes.set(opts.fuelTypes);\n      });\n      // React to Make selection -> load Models\n      effect(() => {\n        const mk = this.selectedMakeId();\n        this.selectedModelId.set(null);\n        this.models.set([]);\n        this.variants.set([]);\n        this.selectedVariantId.set(null);\n        if (mk) {\n          this.api.getModels(mk).subscribe(xs => this.models.set(xs));\n        }\n      });\n      // React to Model selection -> load Variants across generations\n      effect(() => {\n        const mdl = this.selectedModelId();\n        this.variants.set([]);\n        this.selectedVariantId.set(null);\n        if (mdl) {\n          this.api.getGenerations(mdl).subscribe(gens => {\n            if (!gens || gens.length === 0) {\n              this.variants.set([]);\n              return;\n            }\n            const obs = gens.map(g => this.api.getVariantsByGeneration(g.id));\n            // Combine all variants from all generations\n            Promise.all(obs.map(o => o.toPromise())).then(results => {\n              const combined = results.flat();\n              this.variants.set(combined);\n            }).catch(() => this.variants.set([]));\n          });\n        }\n      });\n    }\n    static ɵfac = function SearchComponent_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || SearchComponent)();\n    };\n    static ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: SearchComponent,\n      selectors: [[\"app-search\"]],\n      standalone: true,\n      features: [i0.ɵɵStandaloneFeature],\n      decls: 55,\n      vars: 24,\n      consts: [[1, \"search-container\"], [1, \"filters\"], [\"appearance\", \"fill\", 1, \"full\"], [3, \"selectionChange\", \"value\"], [3, \"value\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [3, \"selectionChange\", \"value\", \"disabled\"], [1, \"results\"], [1, \"results-header\"], [\"mode\", \"indeterminate\", 4, \"ngIf\"], [\"class\", \"muted\", 4, \"ngIf\"], [1, \"grid\"], [\"class\", \"car-card\", 4, \"ngFor\", \"ngForOf\"], [\"mode\", \"indeterminate\"], [1, \"muted\"], [1, \"car-card\"], [1, \"specs\"], [1, \"price\"]],\n      template: function SearchComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"h3\");\n          i0.ɵɵtext(3, \"Filters\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(4, \"mat-form-field\", 2)(5, \"mat-label\");\n          i0.ɵɵtext(6, \"Make\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(7, \"mat-select\", 3);\n          i0.ɵɵlistener(\"selectionChange\", function SearchComponent_Template_mat_select_selectionChange_7_listener($event) {\n            return ctx.selectedMakeId.set($event.value);\n          });\n          i0.ɵɵelementStart(8, \"mat-option\", 4);\n          i0.ɵɵtext(9, \"All\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(10, SearchComponent_mat_option_10_Template, 2, 2, \"mat-option\", 5);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(11, \"mat-form-field\", 2)(12, \"mat-label\");\n          i0.ɵɵtext(13, \"Model\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(14, \"mat-select\", 6);\n          i0.ɵɵlistener(\"selectionChange\", function SearchComponent_Template_mat_select_selectionChange_14_listener($event) {\n            return ctx.selectedModelId.set($event.value);\n          });\n          i0.ɵɵelementStart(15, \"mat-option\", 4);\n          i0.ɵɵtext(16, \"All\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(17, SearchComponent_mat_option_17_Template, 2, 2, \"mat-option\", 5);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(18, \"mat-form-field\", 2)(19, \"mat-label\");\n          i0.ɵɵtext(20, \"Variant\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(21, \"mat-select\", 6);\n          i0.ɵɵlistener(\"selectionChange\", function SearchComponent_Template_mat_select_selectionChange_21_listener($event) {\n            return ctx.selectedVariantId.set($event.value);\n          });\n          i0.ɵɵelementStart(22, \"mat-option\", 4);\n          i0.ɵɵtext(23, \"All\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(24, SearchComponent_mat_option_24_Template, 2, 2, \"mat-option\", 5);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(25, \"mat-form-field\", 2)(26, \"mat-label\");\n          i0.ɵɵtext(27, \"Transmission\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(28, \"mat-select\", 3);\n          i0.ɵɵlistener(\"selectionChange\", function SearchComponent_Template_mat_select_selectionChange_28_listener($event) {\n            return ctx.selectedTransmissionId.set($event.value);\n          });\n          i0.ɵɵelementStart(29, \"mat-option\", 4);\n          i0.ɵɵtext(30, \"All\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(31, SearchComponent_mat_option_31_Template, 2, 2, \"mat-option\", 5);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(32, \"mat-form-field\", 2)(33, \"mat-label\");\n          i0.ɵɵtext(34, \"Body Type\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(35, \"mat-select\", 3);\n          i0.ɵɵlistener(\"selectionChange\", function SearchComponent_Template_mat_select_selectionChange_35_listener($event) {\n            return ctx.selectedBodyTypeId.set($event.value);\n          });\n          i0.ɵɵelementStart(36, \"mat-option\", 4);\n          i0.ɵɵtext(37, \"All\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(38, SearchComponent_mat_option_38_Template, 2, 2, \"mat-option\", 5);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(39, \"mat-form-field\", 2)(40, \"mat-label\");\n          i0.ɵɵtext(41, \"Fuel Type\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(42, \"mat-select\", 3);\n          i0.ɵɵlistener(\"selectionChange\", function SearchComponent_Template_mat_select_selectionChange_42_listener($event) {\n            return ctx.selectedFuelTypeId.set($event.value);\n          });\n          i0.ɵɵelementStart(43, \"mat-option\", 4);\n          i0.ɵɵtext(44, \"All\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(45, SearchComponent_mat_option_45_Template, 2, 2, \"mat-option\", 5);\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵelementStart(46, \"div\", 7)(47, \"div\", 8)(48, \"h3\");\n          i0.ɵɵtext(49, \"Cars\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(50, SearchComponent_mat_progress_bar_50_Template, 1, 0, \"mat-progress-bar\", 9)(51, SearchComponent_div_51_Template, 2, 1, \"div\", 10);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(52, \"div\", 11);\n          i0.ɵɵtemplate(53, SearchComponent_mat_card_53_Template, 19, 12, \"mat-card\", 12)(54, SearchComponent_div_54_Template, 2, 0, \"div\", 10);\n          i0.ɵɵelementEnd()()();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(7);\n          i0.ɵɵproperty(\"value\", ctx.selectedMakeId());\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"value\", null);\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"ngForOf\", ctx.makes());\n          i0.ɵɵadvance(4);\n          i0.ɵɵproperty(\"value\", ctx.selectedModelId())(\"disabled\", !ctx.selectedMakeId());\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"value\", null);\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"ngForOf\", ctx.models());\n          i0.ɵɵadvance(4);\n          i0.ɵɵproperty(\"value\", ctx.selectedVariantId())(\"disabled\", !ctx.selectedModelId());\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"value\", null);\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"ngForOf\", ctx.variants());\n          i0.ɵɵadvance(4);\n          i0.ɵɵproperty(\"value\", ctx.selectedTransmissionId());\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"value\", null);\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"ngForOf\", ctx.transmissions());\n          i0.ɵɵadvance(4);\n          i0.ɵɵproperty(\"value\", ctx.selectedBodyTypeId());\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"value\", null);\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"ngForOf\", ctx.bodyTypes());\n          i0.ɵɵadvance(4);\n          i0.ɵɵproperty(\"value\", ctx.selectedFuelTypeId());\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"value\", null);\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"ngForOf\", ctx.fuelTypes());\n          i0.ɵɵadvance(5);\n          i0.ɵɵproperty(\"ngIf\", ctx.loading());\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", !ctx.loading());\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"ngForOf\", ctx.filteredListings());\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", !ctx.loading() && ctx.filteredListings().length === 0);\n        }\n      },\n      dependencies: [CommonModule, i1.NgForOf, i1.NgIf, i1.DecimalPipe, MatFormFieldModule, i2.MatFormField, i2.MatLabel, MatSelectModule, i3.MatSelect, i4.MatOption, MatIconModule, MatCardModule, i5.MatCard, i5.MatCardContent, i5.MatCardHeader, i5.MatCardSubtitle, i5.MatCardTitle, MatProgressBarModule, i6.MatProgressBar],\n      styles: [\".search-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:300px 1fr;gap:16px}.filters[_ngcontent-%COMP%]{padding:8px}.results-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:12px}.car-card[_ngcontent-%COMP%]{display:flex;flex-direction:column}.specs[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}.price[_ngcontent-%COMP%]{font-weight:600;margin-top:12px}.full[_ngcontent-%COMP%]{width:100%}.muted[_ngcontent-%COMP%]{color:#0009}\"]\n    });\n  }\n  return SearchComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}